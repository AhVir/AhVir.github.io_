<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>Secure File Upload</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <script src="https://cdn.tailwindcss.com"></script>
    <script defer src="https://www.gstatic.com/firebasejs/10.12.0/firebase-app-compat.js"></script>
    <script defer src="https://www.gstatic.com/firebasejs/10.12.0/firebase-storage-compat.js"></script>
  </head>
  <body class="bg-gray-100 min-h-screen flex flex-col items-center justify-center p-6">
    <div id="auth" class="text-center">
      <input
        id="password"
        type="password"
        placeholder="Enter password"
        class="px-4 py-2 border rounded-lg"
      />
      <button
        onclick="checkPassword()"
        class="mt-2 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition"
      >
        Unlock
      </button>
    </div>

    <div id="upload-section" class="hidden w-full max-w-md mt-6">
      <h1 class="text-xl font-bold mb-4 text-center">Upload a File</h1>
      <input type="file" id="fileInput" class="mb-4" />
      <button
        onclick="uploadFile()"
        class="w-full px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition"
      >
        Upload
      </button>

      <h2 class="text-lg font-semibold mt-8 mb-2">Uploaded Files:</h2>
      <ul id="fileList" class="space-y-2"></ul>
    </div>

    <script>
      // TODO: Replace with your actual Firebase config
      const firebaseConfig = {
        apiKey: "AIzaSyAlSYL8XKME1XOskc4pkr_x2r5IrxC30KE",
        authDomain: "ahvir-me.firebaseapp.com",
        databaseURL: "https://ahvir-me-default-rtdb.firebaseio.com",
        projectId: "ahvir-me",
        storageBucket: "ahvir-me.firebasestorage.app",
        messagingSenderId: "715760027236",
        appId: "1:715760027236:web:1ce79d77587c001ccb0171"
      };

      firebase.initializeApp(firebaseConfig);
      const storage = firebase.storage();

      const correctPassword = "your-secret-pass"; // Change this to your real pass

      function checkPassword() {
        const input = document.getElementById("password").value;
        if (input === correctPassword) {
          document.getElementById("auth").classList.add("hidden");
          document.getElementById("upload-section").classList.remove("hidden");
          listFiles();
        } else {
          alert("Incorrect password");
        }
      }

      function uploadFile() {
        const file = document.getElementById("fileInput").files[0];
        if (!file) return alert("No file selected");

        const storageRef = storage.ref("uploads/" + file.name);
        storageRef.put(file).then(() => {
          alert("File uploaded successfully");
          listFiles();
        }).catch(err => alert("Upload failed: " + err));
      }

      function listFiles() {
        const listRef = storage.ref("uploads/");
        listRef.listAll().then(res => {
          const fileList = document.getElementById("fileList");
          fileList.innerHTML = "";
          res.items.forEach(itemRef => {
            itemRef.getDownloadURL().then(url => {
              const li = document.createElement("li");
              li.innerHTML = `<a href="${url}" target="_blank" class="text-blue-600 underline">${itemRef.name}</a>`;
              fileList.appendChild(li);
            });
          });
        });
      }
    </script>
  </body>
</html>
